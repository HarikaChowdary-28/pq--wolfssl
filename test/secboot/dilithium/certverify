//to verify a certificate chain by taking root.pem(rootcert.pem+icacert.pem) + servercert.pem
int cert1(void)
   { 
    int ret;

    WOLFSSL_CERT_MANAGER* cm = NULL;
    

    const char* caCert     = "./DIL-2_DIL-2_DIL-2/certs/root.pem";
    const char* verifyCert = "./DIL-2_DIL-2_DIL-2/certs/servercert.pem";
    

    wolfSSL_Init();
#ifdef DEBUG_WOLFSSL
    wolfSSL_Debugging_ON();
#endif
      
   cm = wolfSSL_CertManagerNew();
    if (cm == NULL) {
        printf("wolfSSL_CertManagerNew() failed\n");
        return -1;
    }

   
    ret = wolfSSL_CertManagerLoadCA(cm, caCert,NULL);
    
    if (ret != WOLFSSL_SUCCESS) {
        printf("wolfSSL_CertManagerLoadCA() failed (%d): %s\n",
                ret, wolfSSL_ERR_reason_error_string(ret));
        ret = -1; goto exit;
    }
    
    ret = wolfSSL_CertManagerVerify(cm, verifyCert, WOLFSSL_FILETYPE_PEM);
    if (ret != WOLFSSL_SUCCESS) {
        printf("wolfSSL_CertManagerVerify() failed (%d): %s\n",
                ret, wolfSSL_ERR_reason_error_string(ret));
        ret = -1; goto exit;
    }
    
    printf("Certificate Chain Verification Successful!\n");
  
exit:
    wolfSSL_CertManagerFree(cm);
    wolfSSL_Cleanup();
   return ret;
    }
   
//to take n iterations and calculate the avg time for certificate chain verification
int cert2(void)
{
    int i = 15;
    float sum = 0;
    float avg;
    float avg_t[i];
    
    while(i!=0)
    {
    clock_t t;
    t = clock();    
    cert1();
    i = i-1;   
    
    t = clock() - t;
    double time_taken = ((double)t)/CLOCKS_PER_SEC; // in seconds
    avg_t[i] = time_taken; 
 }
    for(i=0;i<15;i++)
    {
    sum = sum + avg_t[i];
    }
    avg = sum/i;
    printf("Average time taken for certificate chain verify to execute after %d iterations: %f seconds \n", i,avg);
}
